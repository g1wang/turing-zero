## 负载均衡

### 负载均衡
- Ribbon: 封装在服务消费端，消费者维护一份服务提供者列表，通过均衡策略将请求转发给多个服务提供者
- nginx 作为独立进程，通过均衡策略将请求转发给不同单元
- Spring Cloud LoadBalancer  替换 Ribbon



### Ribbon 负载均衡策略

#### 轮询策略（RoundRobinRule）

- 轮询策略理解起来比较简单，就是拿到所有的server集合，然后根据id进行遍历,轮询策略有一个上限，当轮询了10个服务端节点还没有找到可用服务的话，轮询结束

#### 随机策略（RandomRule）

- 随机策略：使用jdk自带的随机数生成工具，生成一个随机数，然后去可用服务列表中拉取服务节点Server。如果当前节点不可用，则进入下一轮随机策略，直到选到可用服务节点为止

#### 可用过滤策略（AvailabilityFilteringRule）

- 过滤掉连接失败的服务节点，并且过滤掉高并发的服务节点，然后从健康的服务节点中，使用轮询策略选出一个节点返回

#### 响应时间权重策略

- 根据响应时间，分配一个权重weight，响应时间越长，weight越小，被选中的可能性越低

#### 轮询失败重试策略（RetryRule）

- 首先使用轮询策略进行负载均衡，如果轮询失败，则再使用轮询策略进行一次重试，相当于重试下一个节点，看下一个节点是否可用，如果再失败，则直接返回失败

#### 并发量最小可用策略（BestAvailableRule）

- 选择一个并发量最小的server返回。轮询所有的server，选择并发量最小的服务节点

#### ZoneAvoidanceRule

- 复合判断server所在区域的性能和server的可用性，来选择server返回

